

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Authentication &mdash; Marktplaats API Userguide 1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/configurationblock.css" type="text/css" />
  
    <link rel="top" title="Marktplaats API Userguide 1.0 documentation" href="index.html"/>
        <link rel="next" title="Place Advertisement" href="place-advertisement.html"/>
        <link rel="prev" title="Overview" href="introduction.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Marktplaats API Userguide</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Authentication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-1-obtaining-authorization-code">Step 1: obtaining authorization code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-2-retrieving-the-access-token">Step 2: Retrieving the <em>access_token</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-3-refreshing-the-access-token">Step 3: Refreshing the <em>access_token</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="place-advertisement.html">Place Advertisement</a><ul>
<li class="toctree-l2"><a class="reference internal" href="place-advertisement.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="place-advertisement.html#step-1-get-the-attributes-for-an-category">Step 1: Get the attributes for an category</a></li>
<li class="toctree-l2"><a class="reference internal" href="place-advertisement.html#step-2-create-the-advertisement-json">Step 2: Create the advertisement JSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="place-advertisement.html#step-3-adding-images">Step 3: Adding images</a></li>
<li class="toctree-l2"><a class="reference internal" href="place-advertisement.html#step-4-buying-features">Step 4: Buying features</a></li>
<li class="toctree-l2"><a class="reference internal" href="place-advertisement.html#step-5-updating-the-advertisement">Step 5: Updating the advertisement</a></li>
<li class="toctree-l2"><a class="reference internal" href="place-advertisement.html#step-6-removing-an-advertisement">Step 6: Removing an advertisement</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="buying-user-features.html">Buy User Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="buying-user-features.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="buying-user-features.html#find-the-available-user-features-that-can-be-bought">Find the available user features that can be bought</a></li>
<li class="toctree-l2"><a class="reference internal" href="buying-user-features.html#buy-feature-to-enhance-the-user-profile">Buy feature to enhance the user profile</a></li>
<li class="toctree-l2"><a class="reference internal" href="buying-user-features.html#buy-feature-to-display-user-reviews">Buy feature to display user reviews</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Marktplaats API Userguide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Authentication</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/authentication.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="authentication">
<span id="index-0"></span><span id="id1"></span><h1>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h1>
<p>The Marktplaats API uses OAuth2 for authentication. For most usage, the <em>authorization_code</em>
grant type should be used. This is basically a 3-legged authentication flow. In this
guide we will give an example on how to do this authentication, which will result
in a valid <em>access_token</em> (and <em>refresh_token</em>) which can be used with the API.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>In order to succesfully authenticate against the Marktplaats API, you need to have your app
registered. In order to do this, contact Marktplaats and ask if you can get access to the API.
You will need to give a <em>redirect_uri</em> which is an endpoint on your side to handle redirects
from the Marktplaats authentication server. In return you will receive a <em>client_id</em> and
<em>client_secret</em>, which is needed in order to do the authentication with the Marktplaats API.</p>
<p>In this example we use the <em>client_id</em> <tt class="docutils literal"><span class="pre">myclientid</span></tt> and <em>client_secret</em> <tt class="docutils literal"><span class="pre">myclientsecret</span></tt>.
The <em>redirect_uri</em> we use is <tt class="docutils literal"><span class="pre">http://localhost:3210/processredirect.php</span></tt></p>
</div>
<div class="section" id="step-1-obtaining-authorization-code">
<h2>Step 1: obtaining authorization code<a class="headerlink" href="#step-1-obtaining-authorization-code" title="Permalink to this headline">¶</a></h2>
<p>In order to get the <em>access_token</em>, the first step is to do a call to the Marktplaats
Authorization server:</p>
<div class="highlight-python"><div class="highlight"><pre>.. code-block:: http
</pre></div>
</div>
<blockquote>
<div>GET /accounts/oauth/authorize?response_type=code&amp;client_id=myclientid&amp;state=randomstate&amp;redirect_uri=http%3A%2F%2Flocalhost%3A3210%2Fprocessredirect.php
Host: auth.marktplaats.nl</div></blockquote>
<p>In the PHP example we POST a HTML form to the <tt class="docutils literal"><span class="pre">authenticate.php</span></tt> with <tt class="docutils literal"><span class="pre">clientId</span></tt>,
<tt class="docutils literal"><span class="pre">clientSecret</span></tt>, <tt class="docutils literal"><span class="pre">authorizationUrl</span></tt>, <tt class="docutils literal"><span class="pre">accessTokenUrl</span></tt> and <tt class="docutils literal"><span class="pre">redirectUri</span></tt> as
parameters. <tt class="docutils literal"><span class="pre">authorizationUrl</span></tt> is the URL which is used to retrieve the <em>authorization_code</em>
while <tt class="docutils literal"><span class="pre">accessTokenUrl</span></tt> is the URL which is used to retrieve the <em>access_token</em>. These URL
for our production site are respectively <tt class="docutils literal"><span class="pre">https://auth.marktplaats.nl/accounts/oauth/authorize</span></tt>
and <tt class="docutils literal"><span class="pre">https://auth.marktplaats.nl/accounts/oauth/token</span></tt></p>
<div class="highlight-PHP"><div class="highlight"><pre><span class="o">..</span> <span class="nx">literalinclude</span><span class="o">::</span> <span class="o">../</span><span class="nx">phpexample</span><span class="o">/</span><span class="nx">authenticate</span><span class="o">.</span><span class="nx">php</span>
</pre></div>
</div>
<p>After performing this step, the user will see a login page (in case he is not yet
logged in on the Marktplaats.nl website) and a confirmation page to grand access to
the client (app) which is requesting the authorization.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The optional parameter <tt class="docutils literal"><span class="pre">state</span></tt> can be used to store information which will later be
returned by the authorization server on the redirect. If you don&#8217;t need to transfer
information, it is a good idea to still put a value in this parameter, in order to
prevent Cross-site request forgery attempts.</p>
</div>
<img alt="_images/accessconfirmation.png" src="_images/accessconfirmation.png" />
</div>
<div class="section" id="step-2-retrieving-the-access-token">
<h2>Step 2: Retrieving the <em>access_token</em><a class="headerlink" href="#step-2-retrieving-the-access-token" title="Permalink to this headline">¶</a></h2>
<p>When the resource owner (user) grants access to your client to access Marktplaats.nl
on his behalf, the Marktplaats Authorization server will redirect the users&#8217; browser
to the provided <em>redirect_uri</em>, which is in our case <tt class="docutils literal"><span class="pre">http://localhost:3210/processredirect.php</span></tt>
with the <tt class="docutils literal"><span class="pre">code</span></tt> as a parameter, which contains the <em>authorization_code</em> to be used to
retrieve the access_token. Our next task is to handle this redirect and retrieve
the <em>access_token</em> using the provided <tt class="docutils literal"><span class="pre">code</span></tt>.</p>
<div class="highlight-PHP"><div class="highlight"><pre><span class="nb">session_start</span><span class="p">();</span>
<span class="nv">$authcode</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
<span class="nv">$state</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">];</span>
</pre></div>
</div>
<p>This starts the PHP session, and stores the provided <tt class="docutils literal"><span class="pre">code</span></tt> in the variable
<tt class="docutils literal"><span class="pre">$authcode</span></tt> as well as the <tt class="docutils literal"><span class="pre">state</span></tt> parameter.</p>
<div class="highlight-PHP"><div class="highlight"><pre><span class="nv">$clientId</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;clientId&#39;</span><span class="p">];</span>
<span class="nv">$clientSecret</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;clientSecret&#39;</span><span class="p">];</span>
<span class="nv">$accessTokenUrl</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;accessTokenUrl&#39;</span><span class="p">];</span>
<span class="nv">$redirectUri</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;redirectUri&#39;</span><span class="p">];</span>


<span class="nv">$params</span> <span class="o">=</span> <span class="s2">&quot;grant_type=authorization_code&amp;code=</span><span class="si">$authcode</span><span class="s2">&amp;redirect_uri=</span><span class="si">$redirectUri</span><span class="s2">&amp;client_id=</span><span class="si">$clientId</span><span class="s2">&amp;client_secret=</span><span class="si">$clientSecret</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="nv">$opts</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;http&#39;</span> <span class="o">=&gt;</span>
<span class="k">array</span><span class="p">(</span>
<span class="s1">&#39;method&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="s1">&#39;header&#39;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;Content-Type: application/json&quot;</span><span class="p">,</span>
<span class="s1">&#39;timeout&#39;</span> <span class="o">=&gt;</span> <span class="mi">60</span>
<span class="p">)</span>
<span class="p">);</span>

<span class="c1">//echo $params;</span>

<span class="nv">$context</span> <span class="o">=</span> <span class="nb">stream_context_create</span><span class="p">(</span><span class="nv">$opts</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$accessTokenUrl</span> <span class="o">.</span> <span class="s2">&quot;?</span><span class="si">$params</span><span class="s2">&quot;</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$context</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40000</span><span class="p">);</span>
<span class="nv">$jsonresult</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
<span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$jsonresult</span><span class="o">-&gt;</span><span class="na">access_token</span><span class="p">;</span>
<span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$jsonresult</span><span class="o">-&gt;</span><span class="na">refresh_token</span><span class="p">;</span>

<span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Location: index.php&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>With the received <em>authorization_code</em> in the <tt class="docutils literal"><span class="pre">code</span></tt> parameter, and the data
which we stored in the session (which is the <em>client_id</em>, <em>client_secret</em>,
<em>access token url</em> and <em>redirect_uri</em>) we can construct the request to obtain an
<em>access_token</em>. For this, we construct the parameters for the request and do a
POST request to the <em>access token url</em>.</p>
<p>The POST request sent to the server looks like this:</p>
<div class="highlight-HTTP"><div class="highlight"><pre><span class="err">POST /accounts/oauth/token?grant_type=authorization_code&amp;code=akAS72shjuqeah382&amp;redirect_uri=http%3A%2F%2Flocalhost%3A3210%2Fprocessredirect.php&amp;cliend_id=myclientid&amp;client_secret=myclientsecret</span>
<span class="err">Host: auth.marktplaats.nl</span>
</pre></div>
</div>
<p>The result of this POST request should be
a <em>200 OK</em>, and a JSON object in the body which looks like this:</p>
<div class="highlight-JSON"><div class="highlight"><pre><span class="p">{</span>
  <span class="nt">&quot;access_token&quot;</span><span class="p">:</span><span class="s2">&quot;d79b4761-2268-4f03-a068-01eb26b3c7d2&quot;</span><span class="p">,</span>
  <span class="nt">&quot;token_type&quot;</span><span class="p">:</span><span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
  <span class="nt">&quot;expires_in&quot;</span><span class="p">:</span><span class="mi">43199</span><span class="p">,</span>
  <span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span><span class="s2">&quot;d5bd2dcf-1219-4b65-aacc-86149ba55fb0&quot;</span><span class="p">,</span>
  <span class="nt">&quot;scope&quot;</span><span class="p">:</span><span class="s2">&quot;read,write&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You need to store the returned <em>access_token</em> and <em>refresh_token</em>, so you can reuse
it late for authentication and refreshing the <em>access_token</em> in case it is expired.</p>
</div>
<div class="section" id="step-3-refreshing-the-access-token">
<h2>Step 3: Refreshing the <em>access_token</em><a class="headerlink" href="#step-3-refreshing-the-access-token" title="Permalink to this headline">¶</a></h2>
<p>When we receive the <em>access_token</em> we also receive a <em>refresh_token</em>. This can be
used to obtain a new <em>access_token</em>, which is required since the token will expire
after 24 hours. The <em>refresh_token</em> will not expire and as such is crucial in the
process of giving your users an unutrusive experience.</p>
<p>To get a new access token you need to do a HTTP POST request to the token endpoint.
This is very similar to obtaining the access token:</p>
<div class="highlight-PHP"><div class="highlight"><pre><span class="nb">session_start</span><span class="p">();</span>

<span class="nv">$refreshToken</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">];</span>
<span class="nv">$accessTokenUrl</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;accessTokenUrl&#39;</span><span class="p">];</span>
<span class="nv">$clientId</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;clientId&#39;</span><span class="p">];</span>
<span class="nv">$clientSecret</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;clientSecret&#39;</span><span class="p">];</span>

<span class="nv">$params</span> <span class="o">=</span> <span class="s2">&quot;grant_type=refresh_token&amp;refresh_token=</span><span class="si">$refreshToken</span><span class="s2">&amp;client_id=</span><span class="si">$clientId</span><span class="s2">&amp;client_secret=</span><span class="si">$clientSecret</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="nv">$opts</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;http&#39;</span> <span class="o">=&gt;</span>
<span class="k">array</span><span class="p">(</span>
<span class="s1">&#39;method&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="s1">&#39;header&#39;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;Content-Type: application/json&quot;</span><span class="p">,</span>
<span class="s1">&#39;timeout&#39;</span> <span class="o">=&gt;</span> <span class="mi">60</span>
<span class="p">)</span>
<span class="p">);</span>

<span class="nv">$context</span> <span class="o">=</span> <span class="nb">stream_context_create</span><span class="p">(</span><span class="nv">$opts</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$accessTokenUrl</span> <span class="o">.</span> <span class="s2">&quot;?</span><span class="si">$params</span><span class="s2">&quot;</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$context</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40000</span><span class="p">);</span>
<span class="nv">$jsonresult</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
<span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$jsonresult</span><span class="o">-&gt;</span><span class="na">access_token</span><span class="p">;</span>
<span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;refresh_token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$jsonresult</span><span class="o">-&gt;</span><span class="na">refresh_token</span><span class="p">;</span>

<span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Location: index.php&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The http request which is done looks like this:</p>
<div class="highlight-HTTP"><div class="highlight"><pre><span class="err">POST /accounts/oauth/token?grant_type=refresh_token&amp;refresh_token=35f5fb15-9364-464a-854b-9ac0b344f108&amp;redirect_uri=http%3A%2F%2Flocalhost%3A3210%2Fprocessredirect.php&amp;cliend_id=myclientid&amp;client_secret=myclientsecret</span>
<span class="err">Host: auth.marktplaats.nl</span>
</pre></div>
</div>
<p>The returned JSON object has the same structure as the one returned when requesting
an <em>access_token</em>.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="place-advertisement.html" class="btn btn-neutral float-right" title="Place Advertisement"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="introduction.html" class="btn btn-neutral" title="Overview"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Marktplaats bv.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/configurationblock.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>